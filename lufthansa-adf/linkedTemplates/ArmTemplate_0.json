{
	"$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
	"contentVersion": "1.0.0.0",
	"parameters": {
		"factoryName": {
			"type": "string",
			"metadata": "Data Factory name",
			"defaultValue": "lufthansa-adf"
		},
		"AzureDataLakeStorage1_accountKey": {
			"type": "secureString",
			"metadata": "Secure string for 'accountKey' of 'AzureDataLakeStorage1'"
		},
		"AzureDatabricks1_accessToken": {
			"type": "secureString",
			"metadata": "Secure string for 'accessToken' of 'AzureDatabricks1'"
		},
		"AzureSqlDatabase1_connectionString": {
			"type": "secureString",
			"metadata": "Secure string for 'connectionString' of 'AzureSqlDatabase1'"
		},
		"Dummy_connectionString": {
			"type": "secureString",
			"metadata": "Secure string for 'connectionString' of 'Dummy'"
		},
		"Oracledummy_connectionString": {
			"type": "secureString",
			"metadata": "Secure string for 'connectionString' of 'Oracledummy'"
		},
		"SqlServer1_connectionString": {
			"type": "secureString",
			"metadata": "Secure string for 'connectionString' of 'SqlServer1'"
		},
		"AzureSqlDatabase2_connectionString": {
			"type": "secureString",
			"metadata": "Secure string for 'connectionString' of 'AzureSqlDatabase2'"
		},
		"AzureSqlDatabase3_connectionString": {
			"type": "secureString",
			"metadata": "Secure string for 'connectionString' of 'AzureSqlDatabase3'"
		},
		"ADLSGen2Destination_accountKey": {
			"type": "secureString",
			"metadata": "Secure string for 'accountKey' of 'ADLSGen2Destination'"
		},
		"AzureDataLakeStorage1_properties_typeProperties_url": {
			"type": "string",
			"defaultValue": "https://lufthansagen2.dfs.core.windows.net"
		},
		"ADLSGen2Destination_properties_typeProperties_url": {
			"type": "string",
			"defaultValue": "https://adlsgen2demo002.dfs.core.windows.net"
		}
	},
	"variables": {
		"factoryId": "[concat('Microsoft.DataFactory/factories/', parameters('factoryName'))]"
	},
	"resources": [
		{
			"name": "[concat(parameters('factoryName'), '/AzureDataLakeStorage1')]",
			"type": "Microsoft.DataFactory/factories/linkedServices",
			"apiVersion": "2018-06-01",
			"properties": {
				"annotations": [],
				"type": "AzureBlobFS",
				"typeProperties": {
					"url": "[parameters('AzureDataLakeStorage1_properties_typeProperties_url')]",
					"accountKey": {
						"type": "SecureString",
						"value": "[parameters('AzureDataLakeStorage1_accountKey')]"
					}
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/AzureDatabricks1')]",
			"type": "Microsoft.DataFactory/factories/linkedServices",
			"apiVersion": "2018-06-01",
			"properties": {
				"annotations": [],
				"type": "AzureDatabricks",
				"typeProperties": {
					"domain": "https://adb-4030156704576580.0.azuredatabricks.net",
					"accessToken": {
						"type": "SecureString",
						"value": "[parameters('AzureDatabricks1_accessToken')]"
					},
					"existingClusterId": "1223-061934-2oepbkop"
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/AzureSqlDatabase1')]",
			"type": "Microsoft.DataFactory/factories/linkedServices",
			"apiVersion": "2018-06-01",
			"properties": {
				"annotations": [],
				"type": "AzureSqlDatabase",
				"typeProperties": {
					"connectionString": "[parameters('AzureSqlDatabase1_connectionString')]"
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/Dummy')]",
			"type": "Microsoft.DataFactory/factories/linkedServices",
			"apiVersion": "2018-06-01",
			"properties": {
				"annotations": [],
				"type": "AzureBlobStorage",
				"typeProperties": {
					"connectionString": "[parameters('Dummy_connectionString')]"
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/Oracledummy')]",
			"type": "Microsoft.DataFactory/factories/linkedServices",
			"apiVersion": "2018-06-01",
			"properties": {
				"annotations": [],
				"type": "Oracle",
				"typeProperties": {
					"connectionString": "[parameters('Oracledummy_connectionString')]"
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/SqlServer1')]",
			"type": "Microsoft.DataFactory/factories/linkedServices",
			"apiVersion": "2018-06-01",
			"properties": {
				"annotations": [],
				"type": "SqlServer",
				"typeProperties": {
					"connectionString": "[parameters('SqlServer1_connectionString')]"
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/PBIRefreshAndEmail')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "PBIRefreshAndEmail",
						"type": "WebActivity",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"url": {
								"value": "https://prod-18.southeastasia.logic.azure.com:443/workflows/90cf7cd92d3e4fc2bd87fd2dbc8cd41c/triggers/manual/paths/invoke?api-version=2016-10-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=F_c799BW2ydew7K4aGCd4mosbW6KJ-x44Jp8TGnZLio",
								"type": "Expression"
							},
							"method": "POST",
							"headers": {
								"Content-Type": "application/json"
							},
							"body": {
								"value": "{\n\"pbi_datasets\": @{pipeline().parameters.pbi_datasets},\n\"email_info\": {\n\"to\": \"@{pipeline().parameters.email_to}\",\n\"client_name\": \"LTP\",\n\"status\": \"@{pipeline().parameters.status}\",\n\"environment\":\n\"@{pipeline().parameters.environment}\",\n\"message\": \"@{pipeline().parameters.message}\",\n\"start_time\": \"@{pipeline().parameters.start_time}\",\n\"end_time\": \"@{utcnow('dd/MM/yyyy hh:mm:ss tt')}\",\n\"elapsed_time\": \"\",\n\"project_name\": \"Alpine_non-SAP DataSource\",\n\"timezone\": \"[GMT]\",\n\"target\": \"apineadlsstorage\"\n}\n}",
								"type": "Expression"
							}
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"parameters": {
					"email_to": {
						"type": "string"
					},
					"message": {
						"type": "string"
					},
					"status": {
						"type": "string"
					},
					"start_time": {
						"type": "string"
					},
					"environment": {
						"type": "string"
					},
					"pbi_datasets": {
						"type": "array"
					}
				},
				"folder": {
					"name": "ALPINE"
				},
				"annotations": [],
				"lastPublishTime": "2020-10-09T05:45:10Z"
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/AzureSqlDatabase2')]",
			"type": "Microsoft.DataFactory/factories/linkedServices",
			"apiVersion": "2018-06-01",
			"properties": {
				"annotations": [],
				"type": "AzureSqlDatabase",
				"typeProperties": {
					"connectionString": "[parameters('AzureSqlDatabase2_connectionString')]"
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/AzureSqlDatabase3')]",
			"type": "Microsoft.DataFactory/factories/linkedServices",
			"apiVersion": "2018-06-01",
			"properties": {
				"annotations": [],
				"type": "AzureSqlDatabase",
				"typeProperties": {
					"connectionString": "[parameters('AzureSqlDatabase3_connectionString')]"
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/ADLSGen2Destination')]",
			"type": "Microsoft.DataFactory/factories/linkedServices",
			"apiVersion": "2018-06-01",
			"properties": {
				"annotations": [],
				"type": "AzureBlobFS",
				"typeProperties": {
					"url": "[parameters('ADLSGen2Destination_properties_typeProperties_url')]",
					"accountKey": {
						"type": "SecureString",
						"value": "[parameters('ADLSGen2Destination_accountKey')]"
					}
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/Configuration')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "Dummy",
					"type": "LinkedServiceReference"
				},
				"parameters": {
					"config_filename": {
						"type": "string"
					}
				},
				"folder": {
					"name": "ALPINE"
				},
				"annotations": [],
				"type": "DelimitedText",
				"typeProperties": {
					"location": {
						"type": "AzureBlobStorageLocation",
						"fileName": {
							"value": "@dataset().config_filename",
							"type": "Expression"
						},
						"container": "configs"
					},
					"columnDelimiter": ",",
					"escapeChar": "\\",
					"firstRowAsHeader": true,
					"quoteChar": "\""
				},
				"schema": [
					{
						"name": "PARAMETER",
						"type": "String"
					},
					{
						"name": "VALUE",
						"type": "String"
					},
					{
						"name": "UPDATED_BY",
						"type": "String"
					},
					{
						"name": "UPDATED_DATE",
						"type": "String"
					}
				]
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/Dummy')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/LandingDatabackup')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "AzureDataLakeStorage1",
					"type": "LinkedServiceReference"
				},
				"parameters": {
					"container": {
						"type": "string"
					}
				},
				"folder": {
					"name": "ALPINE"
				},
				"annotations": [],
				"type": "Parquet",
				"typeProperties": {
					"location": {
						"type": "AzureBlobFSLocation",
						"fileSystem": {
							"value": "@dataset().container",
							"type": "Expression"
						}
					},
					"compressionCodec": "snappy"
				},
				"schema": []
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/AzureDataLakeStorage1')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/F_PN_INVENTORY_HISTORY')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "AzureDataLakeStorage1",
					"type": "LinkedServiceReference"
				},
				"folder": {
					"name": "ALPINE"
				},
				"annotations": [],
				"type": "Parquet",
				"typeProperties": {
					"location": {
						"type": "AzureBlobFSLocation",
						"folderPath": "targetdb/f_pn_inventory_history",
						"fileSystem": "dwh"
					},
					"compressionCodec": "snappy"
				},
				"schema": []
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/AzureDataLakeStorage1')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/F_PN_INVENTORY_HISTORY_TABLE')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "AzureSqlDatabase1",
					"type": "LinkedServiceReference"
				},
				"folder": {
					"name": "ALPINE"
				},
				"annotations": [],
				"type": "AzureSqlTable",
				"schema": [
					{
						"name": "transaction_no",
						"type": "varchar"
					},
					{
						"name": "transaction_type",
						"type": "varchar"
					},
					{
						"name": "batch",
						"type": "varchar"
					},
					{
						"name": "goods_rcvd_batch",
						"type": "varchar"
					},
					{
						"name": "pn",
						"type": "varchar"
					},
					{
						"name": "sn",
						"type": "varchar"
					},
					{
						"name": "nla",
						"type": "varchar"
					},
					{
						"name": "nha_pn",
						"type": "varchar"
					},
					{
						"name": "nha_sn",
						"type": "varchar"
					},
					{
						"name": "qty",
						"type": "varchar"
					},
					{
						"name": "order_type",
						"type": "varchar"
					},
					{
						"name": "order_no",
						"type": "varchar"
					},
					{
						"name": "order_line",
						"type": "varchar"
					},
					{
						"name": "location",
						"type": "varchar"
					},
					{
						"name": "control",
						"type": "varchar"
					},
					{
						"name": "bin",
						"type": "varchar"
					},
					{
						"name": "condition",
						"type": "varchar"
					},
					{
						"name": "wo",
						"type": "varchar"
					},
					{
						"name": "task_card",
						"type": "varchar"
					},
					{
						"name": "ac",
						"type": "varchar"
					},
					{
						"name": "unit_cost",
						"type": "varchar"
					},
					{
						"name": "currency",
						"type": "varchar"
					},
					{
						"name": "currency_exchange_rate",
						"type": "varchar"
					},
					{
						"name": "vendor",
						"type": "varchar"
					},
					{
						"name": "qty_return_stock",
						"type": "varchar"
					},
					{
						"name": "gl_company",
						"type": "varchar"
					},
					{
						"name": "gl_expenditure",
						"type": "varchar"
					},
					{
						"name": "gl",
						"type": "varchar"
					},
					{
						"name": "gl_cost_center",
						"type": "varchar"
					},
					{
						"name": "status",
						"type": "varchar"
					},
					{
						"name": "awb",
						"type": "varchar"
					},
					{
						"name": "ship_via",
						"type": "varchar"
					},
					{
						"name": "issued_to",
						"type": "varchar"
					},
					{
						"name": "notes",
						"type": "varchar"
					},
					{
						"name": "created_by",
						"type": "varchar"
					},
					{
						"name": "created_date",
						"type": "datetime2",
						"scale": 7
					},
					{
						"name": "modified_by",
						"type": "varchar"
					},
					{
						"name": "modified_date",
						"type": "datetime2",
						"scale": 7
					},
					{
						"name": "to_location",
						"type": "varchar"
					},
					{
						"name": "to_bin",
						"type": "varchar"
					},
					{
						"name": "custom_duty_code",
						"type": "varchar"
					},
					{
						"name": "req_acknowledgement",
						"type": "varchar"
					},
					{
						"name": "req_acknowledgement_by",
						"type": "varchar"
					},
					{
						"name": "req_acknowledgement_date",
						"type": "datetime2",
						"scale": 7
					},
					{
						"name": "unit_sell_override",
						"type": "varchar"
					},
					{
						"name": "unit_sell",
						"type": "varchar"
					},
					{
						"name": "reference",
						"type": "varchar"
					},
					{
						"name": "invoice",
						"type": "varchar"
					},
					{
						"name": "scrap_code",
						"type": "varchar"
					},
					{
						"name": "secondary_cost",
						"type": "varchar"
					},
					{
						"name": "secondary_currency_exchange",
						"type": "varchar"
					},
					{
						"name": "custom_duty_document",
						"type": "varchar"
					},
					{
						"name": "owner",
						"type": "varchar"
					},
					{
						"name": "pass_financial_closing",
						"type": "varchar"
					},
					{
						"name": "technical_record_date",
						"type": "datetime2",
						"scale": 7
					},
					{
						"name": "issued_to_employee",
						"type": "varchar"
					},
					{
						"name": "interface_transfer_by",
						"type": "varchar"
					},
					{
						"name": "interface_transfer_date",
						"type": "datetime2",
						"scale": 7
					},
					{
						"name": "remove_installed_date",
						"type": "datetime2",
						"scale": 7
					},
					{
						"name": "remove_installed_position",
						"type": "varchar"
					},
					{
						"name": "removal_installed_description",
						"type": "varchar"
					},
					{
						"name": "ship_via_account",
						"type": "varchar"
					},
					{
						"name": "ship_via_remarks",
						"type": "varchar"
					},
					{
						"name": "ri_pn_control_reset",
						"type": "varchar"
					},
					{
						"name": "tag_no",
						"type": "varchar"
					},
					{
						"name": "tag_by",
						"type": "varchar"
					},
					{
						"name": "tag_date",
						"type": "datetime2",
						"scale": 7
					},
					{
						"name": "issue_to_employee",
						"type": "varchar"
					},
					{
						"name": "task_card_pn",
						"type": "varchar"
					},
					{
						"name": "task_card_sn",
						"type": "varchar"
					},
					{
						"name": "pre_receipt",
						"type": "varchar"
					},
					{
						"name": "ri_interface_flag",
						"type": "varchar"
					},
					{
						"name": "interface_trnsfr_finance_brzl",
						"type": "datetime2",
						"scale": 7
					},
					{
						"name": "iface_baxter_dissue_xfer_date",
						"type": "datetime2",
						"scale": 7
					},
					{
						"name": "iface_baxter_stmtd_xfer_date",
						"type": "datetime2",
						"scale": 7
					},
					{
						"name": "iface_baxter_dinst_xfer_date",
						"type": "datetime2",
						"scale": 7
					},
					{
						"name": "iface_baxter_dremove_xfer_date",
						"type": "datetime2",
						"scale": 7
					},
					{
						"name": "rtv_reopen_inv_interface_flag",
						"type": "varchar"
					},
					{
						"name": "requisition_line",
						"type": "varchar"
					},
					{
						"name": "adjustment_code",
						"type": "varchar"
					},
					{
						"name": "document_no",
						"type": "varchar"
					},
					{
						"name": "blob_no",
						"type": "varchar"
					},
					{
						"name": "requisition",
						"type": "varchar"
					},
					{
						"name": "created_by_costing_adjust",
						"type": "varchar"
					},
					{
						"name": "defect_type",
						"type": "varchar"
					},
					{
						"name": "defect",
						"type": "varchar"
					},
					{
						"name": "defect_item",
						"type": "varchar"
					},
					{
						"name": "form_1_notes",
						"type": "varchar"
					},
					{
						"name": "nla_position",
						"type": "varchar"
					},
					{
						"name": "signed_pdf",
						"type": "varchar"
					},
					{
						"name": "general_pdf",
						"type": "varchar"
					},
					{
						"name": "reopen_order",
						"type": "varchar"
					},
					{
						"name": "tool_calibration_no",
						"type": "varchar"
					},
					{
						"name": "tax_incentive",
						"type": "varchar"
					},
					{
						"name": "tax_incentive_nbr",
						"type": "varchar"
					},
					{
						"name": "employee_cost_center",
						"type": "varchar"
					},
					{
						"name": "rmv_ins_pn",
						"type": "varchar"
					},
					{
						"name": "rmv_ins_sn",
						"type": "varchar"
					},
					{
						"name": "vendor_lot",
						"type": "varchar"
					},
					{
						"name": "us_number",
						"type": "varchar"
					},
					{
						"name": "remove_as_serviceable",
						"type": "varchar"
					},
					{
						"name": "issued_by",
						"type": "varchar"
					},
					{
						"name": "borrowed_date",
						"type": "datetime2",
						"scale": 7
					},
					{
						"name": "notes_text",
						"type": "varchar"
					},
					{
						"name": "etl_insert_date",
						"type": "datetime2",
						"scale": 7
					},
					{
						"name": "etl_update_date",
						"type": "datetime2",
						"scale": 7
					}
				],
				"typeProperties": {
					"schema": "dbo",
					"table": "f_pn_inventory_history"
				}
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/AzureSqlDatabase1')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/AOLayoverSqlDb')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "SqlServer1",
					"type": "LinkedServiceReference"
				},
				"folder": {
					"name": "ALPINE"
				},
				"annotations": [],
				"type": "SqlServerTable",
				"schema": [],
				"typeProperties": {}
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/SqlServer1')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/LandingStorage')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "AzureDataLakeStorage1",
					"type": "LinkedServiceReference"
				},
				"parameters": {
					"filename": {
						"type": "string"
					},
					"folder": {
						"type": "string"
					}
				},
				"folder": {
					"name": "ALPINE"
				},
				"annotations": [],
				"type": "Parquet",
				"typeProperties": {
					"location": {
						"type": "AzureBlobFSLocation",
						"fileName": {
							"value": "@dataset().filename",
							"type": "Expression"
						},
						"folderPath": {
							"value": "@dataset().folder",
							"type": "Expression"
						},
						"fileSystem": "dwh"
					},
					"compressionCodec": "snappy"
				},
				"schema": []
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/AzureDataLakeStorage1')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/IHRDBSQLServerAzure')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "AzureSqlDatabase1",
					"type": "LinkedServiceReference"
				},
				"folder": {
					"name": "ALPINE"
				},
				"annotations": [],
				"type": "AzureSqlTable",
				"schema": [],
				"typeProperties": {}
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/AzureSqlDatabase1')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/ManhoursSQLServerAzure')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "AzureSqlDatabase1",
					"type": "LinkedServiceReference"
				},
				"folder": {
					"name": "ALPINE"
				},
				"annotations": [],
				"type": "AzureSqlTable",
				"schema": [],
				"typeProperties": {}
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/AzureSqlDatabase1')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/ODB')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "Oracledummy",
					"type": "LinkedServiceReference"
				},
				"folder": {
					"name": "ALPINE"
				},
				"annotations": [],
				"type": "OracleTable",
				"schema": [],
				"typeProperties": {}
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/Oracledummy')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/TALSYS')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "Oracledummy",
					"type": "LinkedServiceReference"
				},
				"folder": {
					"name": "ALPINE"
				},
				"annotations": [],
				"type": "OracleTable",
				"schema": [],
				"typeProperties": {}
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/Oracledummy')]"
			]
		}
	]
}